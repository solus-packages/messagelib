From 6a50aa2ca162af81d28bb3892d7891a610b6b13f Mon Sep 17 00:00:00 2001
From: Peter O'Connor <sunnyflunk@gmail.com>
Date: Thu, 29 Nov 2018 09:27:30 +1100
Subject: [PATCH] Backport security fix from 18.12 branch

Upstream commit 34765909cdf8e55402a8567b48fb288839c61612

---
 .../src/messagepartthemes/default/defaultrenderer.cpp         | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/messageviewer/src/messagepartthemes/default/defaultrenderer.cpp b/messageviewer/src/messagepartthemes/default/defaultrenderer.cpp
index a7ffe82..c237398 100644
--- a/messageviewer/src/messagepartthemes/default/defaultrenderer.cpp
+++ b/messageviewer/src/messagepartthemes/default/defaultrenderer.cpp
@@ -308,6 +308,10 @@ QString processHtml(const QString &htmlSource, QString &extraHead)
             return htmlSource;
         }
         extraHead = s.mid(startIndex + 6 , endIndex - startIndex - 6);
+        //Don't authorize to refresh content.
+        if (s.contains(QStringLiteral("http-equiv=\"REFRESH\""), Qt::CaseInsensitive)) {
+            extraHead.clear();
+        }
         s = s.mid(endIndex + 7).trimmed();
     }
 
--
2.19.2
